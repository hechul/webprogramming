<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>MY PLANNER</title>
   
  <!-- Ìè∞Ìä∏Ïö© -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --bg-color: #f2f4f7;
      --card-bg: #ffffff;
      --text-main: #333;
      --text-sub: #888;
      --accent: #2c3e50;
      --bar-bg: #dce4f7; 
      --bar-text: #325ca8;
      --income: #2980b9;
      --expense: #e74c3c;
      --shadow: 0 10px 30px rgba(0,0,0,0.06);
      --ios-curve: cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * { box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 0; }
    body { background: var(--bg-color); display: flex; justify-content: center; padding: 30px; min-height: 100vh; }

    #app { display: flex; gap: 20px; width: 1280px; max-width: 100%; }
    .main-container { flex: 3; display: flex; flex-direction: column; gap: 20px; }
    .side-container { flex: 1; display: flex; flex-direction: column; gap: 20px; }

    .card { background: var(--card-bg); border-radius: 20px; padding: 24px; box-shadow: var(--shadow); border: 1px solid #fff; }
    
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .calendar-header h1 { font-size: 22px; font-weight: 800; letter-spacing: -1px; }
    .controls { display: flex; align-items: center; gap: 8px; font-size: 16px; font-weight: 700; }
    .nav-btn { width: 32px; height: 32px; border-radius: 50%; border: 1px solid #eee; background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .today-btn { background: var(--accent); color: #fff; border: none; padding: 6px 14px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: 600; }

    .calendar { width: 100%; table-layout: fixed; border-collapse: separate; border-spacing: 0; }
    .calendar th { font-size: 13px; color: var(--text-sub); padding-bottom: 10px; border-bottom: 1px solid #eee; }
    .calendar th.sun { color: #e74c3c; } .calendar th.sat { color: #2980b9; }

    .calendar td {
      height: 110px; vertical-align: top; border-bottom: 1px solid #eee; border-right: 1px solid #eee;
      cursor: pointer; padding: 0; position: relative; background: #fff;
    }
    .calendar td:hover { background: #fafafa; }
    .calendar td.selected { background: #f0f4f8; }
    .calendar td.selected .date-number { background: var(--accent); color: #fff; border-radius: 50%; }

    .date-header { padding: 6px 8px; display: flex; justify-content: space-between; align-items: center; height: 30px; }
    .date-number { font-weight: 600; font-size: 13px; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; }
    .daily-emotion { font-size: 14px; }

    .events-container { display: flex; flex-direction: column; gap: 2px; padding-top: 2px; width: 100%; }
    .event-bar {
      background-color: var(--bar-bg); color: var(--bar-text);
      font-size: 11px; height: 18px; line-height: 18px; padding: 0 6px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600;
    }
    .event-bar.is-start { margin-left: 4px; border-top-left-radius: 4px; border-bottom-left-radius: 4px; }
    .event-bar.is-end { margin-right: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; }
    .event-bar.is-middle { border-radius: 0; }
    .event-bar.is-single { margin: 0 4px; border-radius: 4px; }

    .money-dot-box { position: absolute; bottom: 6px; right: 6px; display: flex; gap: 3px; }
    .money-dot { width: 5px; height: 5px; border-radius: 50%; }
    .money-dot.inc { background: var(--income); } .money-dot.exp { background: var(--expense); }

    .tooltip {
      position: absolute; background: rgba(44, 62, 80, 0.95); color: #fff;
      padding: 12px; border-radius: 12px; font-size: 12px; z-index: 2000;
      pointer-events: none; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      display: none; min-width: 140px; line-height: 1.6; backdrop-filter: blur(4px);
    }
    .tooltip-title { font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 8px; padding-bottom: 4px; }
    .tooltip-money { margin-top: 8px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.2); font-weight: 700; font-size: 11px; }

    .details-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .input-row { display: flex; gap: 6px; margin-bottom: 10px; }
    input, select, textarea { padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; outline: none; }
    .add-btn { background: var(--accent); color: #fff; border: none; border-radius: 8px; width: 36px; height: 34px; cursor: pointer; }
    .list-container { list-style: none; overflow-y: auto; max-height: 150px; }
    .list-container li { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f9f9f9; font-size: 13px; }
    .del-btn { background: none; border: none; color: #ccc; cursor: pointer; }
    .save-btn { width: 100%; padding: 10px; background: #333; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px; }
  </style>


</head>



<body>
  <div id="app">
    <div class="main-container">
      <div class="calendar-section card">
        <header class="calendar-header">
          <h1>MY PLANNER</h1>
          <div class="controls">
            <button id="prevMonth" class="nav-btn"><i class="fas fa-chevron-left"></i></button>
            <span id="monthTitle"></span>
            <button id="nextMonth" class="nav-btn"><i class="fas fa-chevron-right"></i></button>
            <button id="goTodayBtn" class="today-btn">Today</button>
          </div>
        </header>
        <table class="calendar">
          <thead>
            <tr><th class="sun">Ïùº</th><th>Ïõî</th><th>Ìôî</th><th>Ïàò</th><th>Î™©</th><th>Í∏à</th><th class="sat">ÌÜ†</th></tr>
          </thead>
          <tbody id="calendarBody"></tbody>
        </table>
      </div>

      <div class="daily-details-section card" id="dailyDetails">
        <div class="details-header">
          <div>
            <h2 id="selectedDateText">ÎÇ†Ïßú ÏÑ†ÌÉù</h2>
            <span id="selectedEmotionDisplay" style="font-size: 24px;"></span>
          </div>
        </div>
        <div style="display: flex; gap: 20px;">
          <div style="flex: 1;">
            <h3>Schedule</h3>
            <div class="input-row">
              <input type="text" id="todoInput" placeholder="ÏùºÏ†ï" style="flex: 1;">
              <input type="date" id="todoEndDate">
              <button id="addTodoBtn" class="add-btn">+</button>
            </div>
            <ul id="todoList" class="list-container"></ul>
          </div>
          <div style="flex: 1;">
            <h3>Money</h3>
            <div class="input-row">
              <select id="moneyType"><option value="expense">ÏßÄÏ∂ú</option><option value="income">ÏàòÏûÖ</option></select>
              <input type="text" id="expenseTitle" placeholder="ÎÇ¥Ïó≠" style="flex: 1;">
              <input type="number" id="expenseAmount" placeholder="Í∏àÏï°" style="width: 80px;">
              <button id="addExpenseBtn" class="add-btn">OK</button>
            </div>
            <ul id="expenseList" class="list-container"></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="side-container">
      <div class="card">
        <h3>Today's Mood</h3>
        <div style="display: flex; justify-content: space-around; margin-top: 15px;">
          <button class="emo-btn" data-emoji="üòÄ" style="font-size: 24px; border: none; background: none; cursor: pointer;">üòÄ</button>
          <button class="emo-btn" data-emoji="üòê" style="font-size: 24px; border: none; background: none; cursor: pointer;">üòê</button>
          <button class="emo-btn" data-emoji="üò≠" style="font-size: 24px; border: none; background: none; cursor: pointer;">üò≠</button>
          <button class="emo-btn" data-emoji="üò°" style="font-size: 24px; border: none; background: none; cursor: pointer;">üò°</button>
        </div>
        <button id="resetMoodBtn" class="save-btn" style="background: #eee; color: #666;">Mood Reset</button>
      </div>
      <div class="card">
        <h3>Summary</h3>
        <div style="margin-top: 10px;">
          <p>ÏàòÏûÖ: <span id="monthIncome" style="color: var(--income);">0</span></p>
          <p>ÏßÄÏ∂ú: <span id="monthExpense" style="color: var(--expense);">0</span></p>
        </div>
      </div>
      <div class="card">
        <h3>Memo</h3>
        <textarea id="freeMemo" style="width: 100%; height: 100px; margin-top: 10px;"></textarea>
        <button id="saveMemoBtn" class="save-btn">Save Memo</button>
      </div>
    </div>
  </div>

  <div id="calendarTooltip" class="tooltip"></div>

</body>

<script>
const today = new Date();
let currentYear = today.getFullYear();
let currentMonth = today.getMonth();
let selectedDateKey = null;

let calendarData = JSON.parse(localStorage.getItem("myPlannerData") || "{}"); //JSON Í∞ùÏ≤¥ Î∞õÏïÑÏò¥

const monthTitle = document.getElementById("monthTitle");
const calendarBody = document.getElementById("calendarBody");
const tooltip = document.getElementById("calendarTooltip");


// Ï¥àÍ∏∞ Ïã§Ìñâ
window.onload = function init() {
  // Î≤ÑÌäº/Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞
  document.getElementById("goTodayBtn").onclick = goToday;
  document.getElementById("prevMonth").onclick = prevMonth;
  document.getElementById("nextMonth").onclick = nextMonth;
  document.getElementById("addTodoBtn").onclick = addTodo;
  document.getElementById("addExpenseBtn").onclick = addExpense;
  document.getElementById("saveMemoBtn").onclick = saveMemo;
  document.getElementById("resetMoodBtn").onclick = resetMood;

  setupMoodEvents();

  renderCalendar(currentYear, currentMonth); //Ï∫òÎ¶∞Îçî Í∑∏Î¶º

  // Ï≤òÏùå Ïã§Ìñâ Ïãú Ïò§Îäò ÎÇ†Ïßú ÏÑ†ÌÉù
  const todayKey = formatDateKey(today.getFullYear(), today.getMonth() + 1, today.getDate());
  selectDate(todayKey);

  // Î©îÎ™® Î°úÎìú
  document.getElementById("freeMemo").value = localStorage.getItem("myMemo") || "";
}


// Îã¨Î†• Ïù¥Îèô/Î≤ÑÌäº Ìï∏Îì§Îü¨
function goToday() {
  currentYear = today.getFullYear();
  currentMonth = today.getMonth();

  const todayKey = formatDateKey(currentYear, currentMonth + 1, today.getDate());
  renderCalendar(currentYear, currentMonth);
  selectDate(todayKey);
}

function prevMonth() {
  moveMonth(-1);
}

function nextMonth() {
  moveMonth(1);
}

function moveMonth(step) {
  currentMonth += step;
  if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  } else if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  renderCalendar(currentYear, currentMonth);
}

// Îã¨Î†• Í∑∏Î¶¨Í∏∞
function renderCalendar(year, month) {
  monthTitle.textContent = year + "." + String(month + 1).padStart(2, "0");
  calendarBody.innerHTML = "";

  updateMonthlySummary(year, month);

  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  let date = 1;

  for (let i = 0; i < 6; i++) {
    const tr = document.createElement("tr");

    for (let j = 0; j < 7; j++) {
      const td = document.createElement("td");

      if ((i === 0 && j < firstDay) || date > lastDate) {
        td.style.backgroundColor = "#fafafa";
      } else {
        const dateKey = formatDateKey(year, month + 1, date);
        td.dataset.date = dateKey;

        const data = calendarData[dateKey];
        const emoji = data && data.emotion ? data.emotion : "";

        let html = ""
          + '<div class="date-header">'
          +   '<span class="date-number">' + date + '</span>'
          +   '<span class="daily-emotion">' + emoji + '</span>'
          + '</div>'
          + '<div class="events-container">';

        // Ïó∞ÏÜç ÏùºÏ†ï Î∞î(ÏµúÎåÄ 3Í∞ú ÌëúÏãú)
        if (data && data.todos) {
          data.todos.slice(0, 3).forEach(function (todo) {
            const yesterday = new Date(year, month, date - 1);
            const tomorrow = new Date(year, month, date + 1);

            const prevK = formatDateKey(
              yesterday.getFullYear(),
              yesterday.getMonth() + 1,
              yesterday.getDate()
            );
            const nextK = formatDateKey(
              tomorrow.getFullYear(),
              tomorrow.getMonth() + 1,
              tomorrow.getDate()
            );

            const hasPrev = hasEventId(prevK, todo.groupId);
            const hasNext = hasEventId(nextK, todo.groupId);

            let classStr = "is-single";
            if (hasPrev && hasNext) classStr = "is-middle";
            else if (hasPrev && !hasNext) classStr = "is-end";
            else if (!hasPrev && hasNext) classStr = "is-start";

            html += '<div class="event-bar ' + classStr + '">' + todo.text + "</div>";
          });
        }

        html += "</div>";

        // ÏßÄÏ∂ú/ÏàòÏûÖ ÎèÑÌä∏ ÌëúÏãú
        if (data && data.moneyLogs && data.moneyLogs.length > 0) {
          html += '<div class="money-dot-box">';
          data.moneyLogs.forEach(function (l) {
            html += '<div class="money-dot ' + (l.type === "income" ? "inc" : "exp") + '"></div>';
          });
          html += "</div>";
        }

        td.innerHTML = html;

        if (selectedDateKey === dateKey) td.classList.add("selected");

        // Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞ (ÏàòÏóÖ Ïä§ÌÉÄÏùº)
        td.onclick = function () { selectDate(dateKey); };
        td.onmouseenter = function (e) { showTooltip(e, dateKey); };
        td.onmousemove = function (e) { moveTooltip(e); };
        td.onmouseleave = function () { hideTooltip(); };

        date++;
      }

      tr.appendChild(td);
    }

    calendarBody.appendChild(tr);

    if (date > lastDate) break;
  }
}

function hasEventId(key, gid) {
  return !!(gid && calendarData[key] && calendarData[key].todos && calendarData[key].todos.some(function (t) {
    return t.groupId === gid;
  }));
}

// Ìà¥ÌåÅ
function showTooltip(e, key) {
  const data = calendarData[key];
  if (!data) return;

  let html = '<div class="tooltip-title">' + key + "</div>";

  if (data.todos) {
    data.todos.slice(0, 5).forEach(function (t) {
      html += "<div>‚Ä¢ " + t.text + "</div>";
    });
  }

  let inc = 0, exp = 0;
  (data.moneyLogs || []).forEach(function (l) {
    if (l.type === "income") inc += l.amount;
    else exp += l.amount;
  });

  if (inc > 0 || exp > 0) {
    html += '<div class="tooltip-money">';
    if (inc > 0) html += '<div style="color:#4dabf7">ÏàòÏûÖ: +' + inc.toLocaleString() + "</div>";
    if (exp > 0) html += '<div style="color:#ffeb3b">ÏßÄÏ∂ú: -' + exp.toLocaleString() + "</div>";
    html += "</div>";
  }

  tooltip.innerHTML = html;
  tooltip.style.display = "block";
  moveTooltip(e);
}

function moveTooltip(e) {
  tooltip.style.left = (e.pageX + 15) + "px";
  tooltip.style.top = (e.pageY + 15) + "px";
}

function hideTooltip() {
  tooltip.style.display = "none";
}


// ÎÇ†Ïßú ÏÑ†ÌÉù/ÏÉÅÏÑ∏ Î†åÎçî
function selectDate(key) {
  selectedDateKey = key;

  document.getElementById("selectedDateText").textContent = key;

  document.querySelectorAll(".calendar td").forEach(function (td) {
    td.classList.remove("selected");
    if (td.dataset.date === key) td.classList.add("selected");
  });

  const data = calendarData[key];
  document.getElementById("selectedEmotionDisplay").textContent = (data && data.emotion) ? data.emotion : "";

  renderTodoList(key);
  renderMoneyList(key);
}


// Í∏∞Î∂Ñ Î≤ÑÌäº
function setupMoodEvents() {
  document.querySelectorAll(".emo-btn").forEach(function (btn) {
    btn.onclick = function () {
      if (!selectedDateKey) return;
      initData(selectedDateKey);
      calendarData[selectedDateKey].emotion = btn.dataset.emoji;
      saveAndRefresh();
    };
  });
}

function resetMood() {
  if (!selectedDateKey) return;
  if (calendarData[selectedDateKey]) {
    calendarData[selectedDateKey].emotion = null;
    saveAndRefresh();
  }
}


// ÏùºÏ†ï/Í∞ÄÍ≥ÑÎ∂Ä Ï∂îÍ∞Ä
function addTodo() {
  const txt = document.getElementById("todoInput").value;
  const endVal = document.getElementById("todoEndDate").value;

  if (!txt || !selectedDateKey) return;

  const gid = Date.now().toString();

  let curr = new Date(selectedDateKey);
  const end = endVal ? new Date(endVal) : new Date(selectedDateKey);

  while (curr <= end) {
    const k = formatDateKey(curr.getFullYear(), curr.getMonth() + 1, curr.getDate());
    initData(k);
    calendarData[k].todos.push({ text: txt, groupId: gid });
    curr.setDate(curr.getDate() + 1);
  }

  document.getElementById("todoInput").value = "";
  document.getElementById("todoEndDate").value = "";

  saveAndRefresh();
}

function addExpense() {
  if (!selectedDateKey) return;

  const type = document.getElementById("moneyType").value;
  const title = document.getElementById("expenseTitle").value;
  const amt = Number(document.getElementById("expenseAmount").value);

  if (!title || amt <= 0) return;

  initData(selectedDateKey);
  calendarData[selectedDateKey].moneyLogs.push({ type: type, title: title, amount: amt });

  document.getElementById("expenseTitle").value = "";
  document.getElementById("expenseAmount").value = "";

  saveAndRefresh();
}

// Î¶¨Ïä§Ìä∏ Î†åÎçî/ÏÇ≠Ï†ú
function renderTodoList(key) {
  const list = document.getElementById("todoList");
  list.innerHTML = "";

  const arr = (calendarData[key] && calendarData[key].todos) ? calendarData[key].todos : [];

  arr.forEach(function (t, i) {
    const li = document.createElement("li");
    li.innerHTML =
      "<span>" + t.text + '</span>' +
      '<button class="del-btn" onclick="deleteTodo(' + i + ')">' +
      '<i class="fas fa-trash"></i></button>';
    list.appendChild(li);
  });
}

function renderMoneyList(key) {
  const list = document.getElementById("expenseList");
  list.innerHTML = "";

  const arr = (calendarData[key] && calendarData[key].moneyLogs) ? calendarData[key].moneyLogs : [];

  arr.forEach(function (l, i) {
    const li = document.createElement("li");
    li.innerHTML =
      "<span>" + l.title + "</span>" +
      "<span>" + l.amount.toLocaleString() +
      ' <button class="del-btn" onclick="deleteMoney(' + i + ')">x</button></span>';
    list.appendChild(li);
  });
}

function deleteTodo(i) {
  if (!selectedDateKey) return;
  if (!calendarData[selectedDateKey] || !calendarData[selectedDateKey].todos) return;

  const ok = confirm("Ìï¥Îãπ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?");
  if (!ok) return;

  calendarData[selectedDateKey].todos.splice(i, 1);
  saveAndRefresh();
}

function deleteMoney(i) {
  if (!selectedDateKey) return;
  if (!calendarData[selectedDateKey] || !calendarData[selectedDateKey].moneyLogs) return;

  const ok = confirm("Ìï¥Îãπ ÎÇ¥Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?");
  if (!ok) return;

  calendarData[selectedDateKey].moneyLogs.splice(i, 1);
  saveAndRefresh();
}


// ÏõîÍ∞Ñ Ìï©Í≥Ñ / Ï†ÄÏû•
function updateMonthlySummary(y, m) {
  let inc = 0, exp = 0;

  Object.keys(calendarData).forEach(function (k) {
    if (k.startsWith(y + "-" + String(m + 1).padStart(2, "0"))) {
      const logs = calendarData[k].moneyLogs || [];
      logs.forEach(function (l) {
        if (l.type === "income") inc += l.amount;
        else exp += l.amount;
      });
    }
  });

  document.getElementById("monthIncome").textContent = inc.toLocaleString();
  document.getElementById("monthExpense").textContent = exp.toLocaleString();
}

function saveAndRefresh() {
  localStorage.setItem("myPlannerData", JSON.stringify(calendarData));
  renderCalendar(currentYear, currentMonth);
  selectDate(selectedDateKey);
}

function saveMemo() {
  localStorage.setItem("myMemo", document.getElementById("freeMemo").value);
  alert("Î©îÎ™®Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.");
}

// Í≥µÌÜµ Ïú†Ìã∏
function initData(k) {
  if (!calendarData[k]) calendarData[k] = { todos: [], moneyLogs: [] };
}

function formatDateKey(y, m, d) {
  return y + "-" + String(m).padStart(2, "0") + "-" + String(d).padStart(2, "0");
}


</script>
</html>